CREATE TABLE control03 (
    id INT IDENTITY(1,1) PRIMARY KEY,
    Fecha VARCHAR(10),
    Oc VARCHAR(50),
    Descripcion VARCHAR(100),
    Controlo VARCHAR(50),
    Cdmaterial VARCHAR(50),
    Tdlote VARCHAR(50),
    Tdaql VARCHAR(50),
    Estado VARCHAR(50),
    Observaciones VARCHAR(200),
    Codigo VARCHAR(10)
);

CREATE TRIGGER UpdateCodigo
ON control03
AFTER INSERT
AS
BEGIN
    DECLARE @mes VARCHAR(2)
    DECLARE @anio VARCHAR(4)

    SET @mes = RIGHT('0' + CAST(MONTH(GETDATE()) AS VARCHAR(2)), 2)
    SET @anio = CAST(YEAR(GETDATE()) AS VARCHAR(4))

    UPDATE c
    SET Codigo = CONCAT(@mes, @anio,
                CASE WHEN c.id < 10 THEN CAST(c.id AS VARCHAR(1))
                     ELSE CAST(c.id AS VARCHAR(2))
                END)
    FROM control03 c
    INNER JOIN inserted i ON c.id = i.id
END






